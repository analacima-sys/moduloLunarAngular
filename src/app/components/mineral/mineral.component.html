<!-- src/app/components/mineral/mineral.component.html -->

<!-- FORMULARIO  -->
<mat-card>
  <mat-card-header>
    <mat-card-title i18n="@@mineral-form-titulo">Formulario de entrada</mat-card-title>
  </mat-card-header>
  
  <mat-card-content>
    <form [formGroup]="formularioActivo()" (ngSubmit)="analizar()">

      <!-- ID y Nombre -->
      <div class="row">
        <div class="col-lg-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            @if (configSvc.modo() === ModoFormulario.Extendido) {
              <mat-label i18n="@@mineral-form-label-id">ID (LLDDDDLL)</mat-label>
            }
            <input matInput formControlName="id" 
                   [placeholder]="configSvc.modo() === ModoFormulario.Reducido ? 'ID (LLDDDDLL)' : 'Ej: AB1234CD'"
                   i18n-placeholder="@@mineral-form-placeholder-id">
            @if (formularioActivo().get('id')?.hasError('required')) {
              <mat-error i18n="@@mineral-form-error-id-required">El ID es requerido</mat-error>
            }
            @if (formularioActivo().get('id')?.hasError('pattern')) {
              <mat-error i18n="@@mineral-form-error-id-pattern">Formato: 2 letras, 4 dÃ­gitos, 2 letras</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="col-lg-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            @if (configSvc.modo() === ModoFormulario.Extendido) {
              <mat-label i18n="@@mineral-form-label-nombre">Nombre</mat-label>
            }
            <input matInput formControlName="nombre" 
                   [placeholder]="configSvc.modo() === ModoFormulario.Reducido ? 'Nombre' : ''"
                   i18n-placeholder="@@mineral-form-placeholder-nombre">
            @if (formularioActivo().get('nombre')?.hasError('required')) {
              <mat-error i18n="@@mineral-form-error-nombre">El nombre es requerido</mat-error>
            }
          </mat-form-field>
        </div>
      </div>

      <!-- Grupo / Dureza / TamaÃ±o cristales -->
      <div class="row">
        <div class="col-lg-6 mb-3">
          @if (configSvc.modo() === ModoFormulario.Extendido) {
            <label class="mat-subtitle-2 mb-2 d-block" i18n="@@mineral-form-label-grupo">Grupo / Origen</label>
          }
          <mat-radio-group formControlName="grupo" class="d-flex flex-column gap-2">
            @for (g of tiposRoca; track g) {
              <mat-radio-button [value]="g">
                {{ g | traducirEnum:locale }}
              </mat-radio-button>
            }
          </mat-radio-group>
        </div>

        <div class="col-lg-3 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label i18n="@@mineral-form-label-dureza">Dureza (1-10)</mat-label>
            <mat-select formControlName="dureza">
              @for (n of [1,2,3,4,5,6,7,8,9,10]; track n) {
                <mat-option [value]="n">{{ n }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-lg-3 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label i18n="@@mineral-form-label-tamano-cristales">TamaÃ±o de cristales (0-10)</mat-label>
            <mat-select formControlName="tamanoCristales">
              @for (n of [0,1,2,3,4,5,6,7,8,9,10]; track n) {
                <mat-option [value]="n">{{ n }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <!-- TamaÃ±o de grano + ClasificaciÃ³n + Temperatura -->
      <div class="row">
        <div class="col-lg-6 mb-3">
          @if (configSvc.modo() === ModoFormulario.Extendido) {
            <label class="mat-subtitle-2 mb-2 d-block" i18n="@@mineral-form-label-tamano-grano">TamaÃ±o de grano</label>
          }
          <mat-radio-group formControlName="tamanoGrano" class="d-flex flex-wrap gap-3">
            @for (tg of tamaniosGrano; track tg) {
              <mat-radio-button [value]="tg">
                {{ tg | traducirEnum:locale }}
              </mat-radio-button>
            }
          </mat-radio-group>
        </div>

        <div class="col-lg-3 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label i18n="@@mineral-form-label-clasificacion">ClasificaciÃ³n</mat-label>
            <mat-select formControlName="clasificacion">
              @for (c of clasificaciones; track c) {
                <mat-option [value]="c">{{ c | traducirEnum:locale }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-lg-3 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label i18n="@@mineral-form-label-temperatura">Temperatura (K)</mat-label>
            <input matInput type="number" formControlName="temperaturaFormacion">
            <mat-hint i18n="@@mineral-form-hint-temperatura">Rango: -100 a 100 K</mat-hint>
            @if (formularioActivo().get('temperaturaFormacion')?.hasError('min')) {
              <mat-error i18n="@@mineral-form-error-temp-min">MÃ­nimo: -100 K</mat-error>
            }
            @if (formularioActivo().get('temperaturaFormacion')?.hasError('max')) {
              <mat-error i18n="@@mineral-form-error-temp-max">MÃ¡ximo: 100 K</mat-error>
            }
          </mat-form-field>
        </div>
      </div>

      <!-- Estructura / Forma de los granos -->
      <div class="row">
        <div class="col-12 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label i18n="@@mineral-form-label-estructura">Estructura</mat-label>
            <textarea matInput formControlName="estructura" rows="2"
                      i18n-placeholder="@@mineral-form-placeholder-estructura"
                      placeholder="DescripciÃ³n de la estructura"></textarea>
          </mat-form-field>
        </div>

        <div class="col-12 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label i18n="@@mineral-form-label-forma-granos">Forma de los granos</mat-label>
            <textarea matInput formControlName="formaGranos" rows="2"
                      i18n-placeholder="@@mineral-form-placeholder-forma-granos"
                      placeholder="DescripciÃ³n de la forma de los granos"></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Textura -->
      <div class="row">
        <div class="col-12 mb-3">
          @if (configSvc.modo() === ModoFormulario.Extendido) {
            <label class="mat-subtitle-2 mb-2 d-block" i18n="@@mineral-form-label-textura">Textura</label>
          }
          <mat-radio-group formControlName="textura" class="d-flex flex-column gap-2">
            @for (t of texturas; track t) {
              <mat-radio-button [value]="t">
                {{ t | traducirEnum:locale }}
              </mat-radio-button>
            }
          </mat-radio-group>
        </div>
      </div>

      <!-- Botones -->
      <div class="d-flex gap-2 mt-3">
        <button mat-raised-button color="primary" type="submit" [disabled]="formularioActivo().invalid"
                i18n="@@mineral-form-btn-analizar">
          Analizar Mineral
        </button>
        <button mat-stroked-button type="button" (click)="limpiar()"
                i18n="@@mineral-form-btn-limpiar">
          Limpiar
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<!-- RESULTADO -->
@if (esValido() !== null) {
<div class="card mt-3" [ngClass]="esValido() ? 'border-success' : 'border-danger'">
  <div class="card-header" [ngClass]="esValido() ? 'bg-success text-white' : 'bg-danger text-white'">
    @if (esValido()) {
      <span i18n="@@mineral-resultado-valido">âœ“ Mineral vÃ¡lido</span>
    } @else {
      <span i18n="@@mineral-resultado-invalido">âœ— Mineral no vÃ¡lido</span>
    }
  </div>
  <div class="card-body text-center">
    <div class="emoji-result">
      @if (esValido()) {
      <span>ðŸ˜„</span>
      } @else {
      <span>ðŸ˜¢</span>
      }
    </div>
    <p class="mt-2">
      {{ ultimoMineral()?.nombre || 'El mineral' }}
      @if (esValido()) {
        <span i18n="@@mineral-resultado-cumple"> cumple </span>
      } @else {
        <span i18n="@@mineral-resultado-no-cumple"> no cumple </span>
      }
      <span i18n="@@mineral-resultado-criterio">el criterio</span> {{ configSvc.criterio().toLowerCase() | traducirEnum:locale }}.
    </p>
  </div>
</div>
}

<!-- TABLA DE DATOS DEL MINERAL -->
@if (ultimoMineral() && esValido()) {
<div class="card mt-3">
  <div class="card-header bg-info text-white" i18n="@@mineral-datos-titulo">Datos del mineral</div>
  <div class="card-body">
    <div class="row">
      <div class="col-lg-6">
        <table class="table">
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-id">ID:</td>
            <td>{{ ultimoMineral()!.id }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-nombre">Nombre:</td>
            <td>{{ ultimoMineral()!.nombre }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-grupo">Grupo:</td>
            <td>{{ ultimoMineral()!.grupo | traducirEnum:locale }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-dureza">Dureza:</td>
            <td>{{ ultimoMineral()!.dureza }} (Mohs)</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-tamano-grano">TamaÃ±o de grano:</td>
            <td>{{ ultimoMineral()!.tamanoGrano | traducirEnum:locale }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-textura">Textura:</td>
            <td>{{ ultimoMineral()!.textura | traducirEnum:locale }}</td>
          </tr>
        </table>
      </div>

      <div class="col-lg-6">
        <table class="table">
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-clasificacion">ClasificaciÃ³n:</td>
            <td>{{ ultimoMineral()!.clasificacion | traducirEnum:locale }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-tamano-cristales">TamaÃ±o de cristales:</td>
            <td>{{ ultimoMineral()!.tamanoCristales }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-temperatura">Temperatura:</td>
            <td>{{ temperaturaFormateada(ultimoMineral()!.temperaturaFormacion) }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-estructura">Estructura:</td>
            <td>{{ ultimoMineral()!.estructura || 'â€”' }}</td>
          </tr>
          <tr>
            <td class="fw-bold" i18n="@@mineral-datos-forma-granos">Forma de los granos:</td>
            <td>{{ ultimoMineral()!.formaGranos || 'â€”' }}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
}