<!-- src/app/components/mineral/mineral.component.html -->

<!-- PANTALLA DE USUARIO 
<div class="card bg-dark text-white">
  <div class="card-body">
    <h1 class="h3 mb-2">MÃ³dulo Lunar</h1>
    <div class="alert alert-info mb-0 mt-3">
      <strong>Usuario:</strong> <span id="astronautaInfo"></span>
    </div>
    <input type="button" class="btn btn-light mt-3" value="Ver Inventario" id="verInventario" />
  </div>
</div>
-->

<!-- PANTALLA DE CONFIGURACIÃ“N -->
<div class="card">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">ConfiguraciÃ³n</h5>
  </div>
  <div class="card-body">
    <div class="row">
      <!-- Columna 1: Modo de formulario -->
      <div class="col-lg-4 mb-3 mb-lg-0">
        <fieldset>
          <legend class="form-label">Modo de formulario:</legend>
          <div class="btn-group w-100" aria-label="SelecciÃ³n de modo de formulario">
            <input type="radio" class="btn-check" name="modoFormulario" id="btnExtendido" value="extendido" checked
              autocomplete="off" [class.active]="modoActual() === ModoFormulario.Extendido"
              (click)="cambiarModo(ModoFormulario.Extendido)" />
            <label class="btn btn-outline-primary" for="btnExtendido">Extendido</label>

            <input type="radio" class="btn-check" name="modoFormulario" id="btnReducido" value="reducido"
              autocomplete="off" [class.active]="modoActual() === ModoFormulario.Reducido"
              (click)="cambiarModo(ModoFormulario.Reducido)" />
            <label class="btn btn-outline-primary" for="btnReducido">Reducido</label>
          </div>
        </fieldset>
      </div>

      <!-- Columna 2: Criterio de validaciÃ³n -->
      <div class="col-lg-4 mb-3 mb-lg-0">
        <fieldset>
          <legend class="form-label">Criterio de validaciÃ³n:</legend>
          <select class="form-select" [value]="criterioSeleccionado()"
            (change)="cambiarCriterio($any($event.target).value)">
            @for (c of Object.values(criterios); track c) {
            <option [value]="c">{{ traducir(c) }}</option>
            }
          </select>
        </fieldset>
      </div>

      <!-- Columna 3: Formato de salida -->
      <div class="col-lg-4">
        <fieldset>
          <legend class="form-label">Formato de salida:</legend>
          <div class="btn-group w-100" aria-label="SelecciÃ³n de formato de salida">
            <input type="radio" class="btn-check" name="formatoSalida" id="btnEuropeo" value="europeo" checked
              autocomplete="off" [class.active]="formatoSalida() === 'europeo'" (click)="cambiarFormato('europeo')" />
            <label class="btn btn-outline-primary" for="btnEuropeo">Europeo</label>

            <input type="radio" class="btn-check" name="formatoSalida" id="btnAmericano" value="americano"
              autocomplete="off" [class.active]="formatoSalida() === 'americano'"
              (click)="cambiarFormato('americano')" />
            <label class="btn btn-outline-primary" for="btnAmericano">Americano</label>
          </div>
        </fieldset>
      </div>
    </div>
  </div>
</div>

<!-- PANTALLA DE FORMULARIO -->
<div class="card">
  <div class="card-header bg-secondary text-white">
    <h5 class="mb-0">
      Formulario de entrada
      <!-- {{ formatoSalida() === 'americano' ? 'Mineral Entry' : 'Entrada de minerales' }}-->
    </h5>
  </div>
  <!-- formulario -->
  <div class="card-body">
    <form [formGroup]="formularioActivo()" (ngSubmit)="analizar()">

      <!-- ID y Nombre -->
      <div class="row">
        <div class="col-lg-6 mb-3">
          @if (modoActual() === ModoFormulario.Extendido) {
          <label class="form-label-extended">{{ labelId }}</label>
          }
          <input formControlName="id" class="form-control"
            [placeholder]="modoActual() === ModoFormulario.Reducido ? labelId : 'Ej: AB1234CD'">

          @if (formularioActivo().get('id')?.touched && formularioActivo().get('id')?.invalid) {
          <div class="hint-text text-danger">
            {{ formatoSalida() === 'americano'
            ? 'Invalid ID. Format: 2 letters, 4 numbers, 2 letters.'
            : 'ID invÃ¡lido. Formato: 2 letras, 4 nÃºmeros, 2 letras.' }}
          </div>
          }
        </div>

        <div class="col-lg-6 mb-3">
          @if (modoActual() === ModoFormulario.Extendido) {
          <label class="form-label-extended">{{ labelNombre }}</label>
          }
          <input formControlName="nombre" class="form-control"
            [class.is-invalid]="formularioActivo().get('nombre')?.touched && formularioActivo().get('nombre')?.invalid"
            [placeholder]="modoActual() === ModoFormulario.Reducido ? labelNombre : ''">

          @if (formularioActivo().get('nombre')?.touched && formularioActivo().get('nombre')?.invalid) {
          <div class="hint-text text-danger">
            {{ formatoSalida() === 'americano'
            ? 'Name is required.'
            : 'El nombre es requerido.' }}
          </div>
          }
        </div>
      </div>

      <!-- Grupo / Dureza / TamaÃ±o cristales -->
      <div class="row">
        <div class="col-lg-6 mb-3">
          <label class="form-label-extended">{{ labelGrupo }}</label>
          @for (g of tiposRoca; track g) {
          <div class="form-check">
            <input class="form-check-input" type="radio" [value]="g" formControlName="grupo" [id]="'g-'+g">
            <label class="form-check-label" [for]="'g-'+g">{{ traducir(g) }}</label>
          </div>
          }
        </div>

        <div class="col-lg-3 mb-3">
          <label class="form-label-extended">{{ labelDureza }}</label>
          <select formControlName="dureza" class="form-select">
            @for (n of [1,2,3,4,5,6,7,8,9,10]; track n) {
            <option [value]="n">{{ n }}</option>
            }
          </select>
        </div>

        <div class="col-lg-3 mb-3">
          <label class="form-label-extended">{{ labelTamanoCristales }}</label>
          <select formControlName="tamanoCristales" class="form-select">
            @for (n of [0,1,2,3,4,5,6,7,8,9,10]; track n) {
            <option [value]="n">{{ n }}</option>
            }
          </select>
        </div>
      </div>

      <!-- TamaÃ±o de grano + ClasificaciÃ³n + Temperatura -->
      <div class="row">
        <div class="col-lg-6 mb-3">
          <label class="form-label-extended">{{ labelTamanoGrano }}</label>
          <div class="d-flex gap-3 flex-wrap">
            @for (tg of tamaniosGrano; track tg) {
            <div class="form-check">
              <input class="form-check-input" type="radio" [value]="tg" formControlName="tamanoGrano" [id]="'tg-'+tg">
              <label class="form-check-label" [for]="'tg-'+tg">{{ traducir(tg) }}</label>
            </div>
            }
          </div>
        </div>

        <div class="col-lg-3 mb-3">
          <label class="form-label-extended">{{ labelClasificacion }}</label>
          <select formControlName="clasificacion" class="form-select">
            @for (c of clasificaciones; track c) {
            <option [value]="c">{{ traducir(c) }}</option>
            }
          </select>
        </div>

        <div class="col-lg-3 mb-3">
          <label class="form-label-extended">{{ labelTemperatura }}</label>
          <input type="number" formControlName="temperaturaFormacion" class="form-control" placeholder="">
          <div class="hint-text">
            {{ formatoSalida() === 'americano' ? 'Range: -100 to 100 K' : 'Rango: -100 a 100 K' }}
          </div>
        </div>
      </div>

      <!-- Estructura / Forma de los granos -->
      <div class="row">
        <div class="col-12 mb-3">
          <label class="form-label-extended">{{ labelEstructura }}</label>
          <textarea formControlName="estructura" rows="2" class="form-control"
            [placeholder]="formatoSalida() === 'americano' ? 'Structure description' : 'DescripciÃ³n de la estructura'"></textarea>
        </div>

        <div class="col-12 mb-3">
          <label class="form-label-extended">{{ labelFormaGranos }}</label>
          <textarea formControlName="formaGranos" rows="2" class="form-control"
            [placeholder]="formatoSalida() === 'americano' ? 'Grain shape description' : 'DescripciÃ³n de la forma de los granos'"></textarea>
        </div>
      </div>

      <!-- Textura -->
      <div class="row">
        <div class="col-12 mb-3">
          <label class="form-label-extended">{{ labelTextura }}</label>
          @for (t of texturas; track t) {
          <div class="form-check">
            <input class="form-check-input" type="radio" [value]="t" formControlName="textura" [id]="'t-'+t">
            <label class="form-check-label" [for]="'t-'+t">{{ traducir(t) }}</label>
          </div>
          }
        </div>
      </div>

      <!-- Botones -->
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary" [disabled]="formularioActivo().invalid">
          {{ textoAnalizar }}
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="limpiar()">
          {{ textoLimpiar }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- RESULTADO -->
@if (esValido() !== null) {
<div class="card mt-3" [ngClass]="esValido() ? 'border-success' : 'border-danger'">
  <div class="card-header" [ngClass]="esValido() ? 'bg-success text-white' : 'bg-danger text-white'">
    {{ esValido() ? textoValido : textoNoValido }}
  </div>
  <div class="card-body text-center">
    <div class="emoji-result">
      @if (esValido()) {
      <span>ðŸ˜„</span>
      } @else {
      <span>ðŸ˜¢</span>
      }
    </div>
    <p class="mt-2">
      {{ ultimoMineral()?.nombre || (formatoSalida() === 'americano' ? 'The mineral' : 'El mineral') }}
      {{ esValido() ? textoCumple : textoNoCumple }}
      {{ textoCriterio }} {{ traducir(criterioSeleccionado()) }}.
    </p>
  </div>
</div>
}

<!-- TABLA DE DATOS DEL MINERAL -->
@if (ultimoMineral() && esValido()) {
<div class="card mt-3">
  <div class="card-header bg-info text-white">{{ textoDatosMineral }}</div>
  <div class="card-body">
    <div class="row">
      <div class="col-lg-6">
        <table class="table">
          <tr>
            <td class="fw-bold">{{ labelId }}:</td>
            <td>{{ ultimoMineral()!.id }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelNombre }}:</td>
            <td>{{ ultimoMineral()!.nombre }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelGrupo }}:</td>
            <td>{{ traducir(ultimoMineral()!.grupo) }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelDureza }}:</td>
            <td>{{ ultimoMineral()!.dureza }} (Mohs)</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelTamanoGrano }}:</td>
            <td>{{ traducir(ultimoMineral()!.tamanoGrano) }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelTextura }}:</td>
            <td>{{ traducir(ultimoMineral()!.textura) }}</td>
          </tr>
        </table>
      </div>

      <div class="col-lg-6">
        <table class="table">
          <tr>
            <td class="fw-bold">{{ labelClasificacion }}:</td>
            <td>{{ traducir(ultimoMineral()!.clasificacion) }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelTamanoCristales }}:</td>
            <td>{{ ultimoMineral()!.tamanoCristales }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelTemperatura }}:</td>
            <td>{{ temperaturaFormateada(ultimoMineral()!.temperaturaFormacion) }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelEstructura }}:</td>
            <td>{{ ultimoMineral()!.estructura || 'â€”' }}</td>
          </tr>
          <tr>
            <td class="fw-bold">{{ labelFormaGranos }}:</td>
            <td>{{ ultimoMineral()!.formaGranos || 'â€”' }}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
}